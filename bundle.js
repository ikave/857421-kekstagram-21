(()=>{"use strict";window.util={randomNum:function(e,t){return Math.round(e+Math.random()*(t-e))},randomValue:function(e){return e[Math.floor(Math.random()*e.length)]},pressEscKey:function(e,t){"Escape"===e.key&&t()},debounce:function(e){let t=null;return function(...n){t&&window.clearTimeout(t),t=window.setTimeout((function(){e(...n)}),500)}}},function(){const e="https://21.javascript.pages.academy/kekstagram",t=function(e,t){let n=new XMLHttpRequest;return n.responseType="json",n.addEventListener("load",(function(){let o;switch(n.status){case 200:e(n.response);break;case 400:o="Неверный запрос";break;case 401:o="Пользователь не авторизован";break;case 404:o="Ничего не найдено";break;default:o=`Cтатус ответа: ${n.status} ${n.statusText}`}o&&t(o)})),n.addEventListener("error",(function(){t("Произошла ошибка соединения")})),n.addEventListener("timeout",(function(){t(`Запрос не успел выполниться за ${n.timeout}мс`)})),n.timeout=1e4,n};window.server={load:function(n,o){const r=t(n,o);r.open("GET",e+"/data"),r.send()},upload:function(n,o,r){const i=t(o,r);i.open("POST",e),i.send(n)}}}(),function(){const e=document.querySelector("body");let t=[];window.server.load((function(e){t=e.slice(),function(e){for(let t=0;t<e.length;t++)e[t].id=t}(t),window.gallery(t),window.preview.data(t),window.filter(t)}),(function(t){const n=document.createElement("div");n.textContent=t,n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.padding="50px",n.style.backgroundColor="red",e.append(n)}))}(),function(){const e=document.querySelector(".img-filters"),t=e.querySelectorAll(".img-filters__button"),n=function(){const e=document.querySelectorAll(".picture");for(let t of e)t.remove()};window.filter=function(o){e.classList.remove("img-filters--inactive");let r=o.slice();e.addEventListener("click",window.util.debounce((function(e){!function(e){for(let n=0;n<t.length;n++)t[n].classList.remove("img-filters__button--active"),e.target===t[n]&&t[n].classList.add("img-filters__button--active")}(e);const i=e.target.id;"filter-default"===e.target.id?(n(),window.gallery(o)):"filter-random"===i?(n(),window.gallery(function(e){return e.slice().sort((function(){return window.util.randomNum(-1,1)})).slice(0,10)}(r))):"filter-discussed"===i&&(n(),window.gallery(function(e){return e.sort((function(e,t){return t.comments.length-e.comments.length}))}(r)))})))}}(),function(){const e=document.querySelector(".big-picture"),t=e.querySelector(".social__comments"),n=e.querySelector(".comments-loader"),o=e.querySelector(".big-picture__cancel"),r=document.querySelector(".pictures");let i,c=0,s=5;const l=function(e,t,n){const o=document.createElement("li");o.classList.add("social__comment");const r=document.createElement("img");r.classList.add("social__picture"),r.setAttribute("src",e[t].avatar),r.setAttribute("alt",e[t].name),r.setAttribute("width","35"),r.setAttribute("height","35");const i=document.createElement("p");i.classList.add("social__text"),i.textContent=e[t].message,o.append(r),o.append(i),n.append(o)},u=function(e){const o=e.comments;o.length<s&&(s=o.length,n.classList.add("hidden"));for(let e=c;e<s;e++)l(o,e,t);c+=5,s+=5},d=function(){u(i)},a=function(){c=0,s=5,e.classList.add("hidden"),n.classList.remove("hidden"),n.removeEventListener("click",d)},f=function(e){window.util.pressEscKey(e,a)};o.addEventListener("click",(function(){a(),function(){let e=t.querySelectorAll(".social__comment");for(let t=0;t<e.length;t++)e[t].remove()}(),window.removeEventListener("keydown",f),o.removeEventListener("click",a)})),window.preview={data:function(e){r.addEventListener("click",(function(t){let n=t.target.closest(".picture");if(n)for(let t of e)t.id.toString()===n.dataset.id&&window.preview.show(t)}))},show:function(o){i=o,e.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.querySelector("body").classList.remove("modal-open"),function(){const e=t.children;for(let t=e.length-1;t>=0;t--)e[t].remove()}(),function(e,t){const n=e.querySelector(".big-picture__img").children,o=e.querySelector(".likes-count"),r=e.querySelector(".comments-count"),c=e.querySelector(".social__caption");n[0].setAttribute("src",t.url),c.textContent=t.description,o.textContent=t.likes,r.textContent=t.comments.length,u(i)}(e,o),n.addEventListener("click",d),window.addEventListener("keydown",f)}}}(),function(){const e=document.querySelector("#picture").content.querySelector(".picture"),t=document.querySelector(".pictures"),n=function(t){const n=e.cloneNode(!0);return n.querySelector(".picture__img").setAttribute("src",t.url),n.querySelector(".picture__img").setAttribute("alt",t.description),n.querySelector(".picture__likes").textContent=t.likes,n.querySelector(".picture__comments").textContent=t.comments.length,n.setAttribute("data-id",t.id),n};window.gallery=function(e){const o=document.createDocumentFragment();for(let t=0;t<e.length;t++)o.appendChild(n(e[t]));t.appendChild(o)}}(),function(){const e=["gif","jpg","jpeg","png"],t=document.querySelector("body"),n=document.querySelector("main"),o=document.querySelector("#upload-file"),r=document.querySelector(".img-upload__overlay"),i=r.querySelector(".effect-level"),c=document.querySelectorAll(".effects__preview"),s=r.querySelector(".effect-level__line"),l=r.querySelector(".effect-level__pin"),u=r.querySelector(".effect-level__depth"),d=r.querySelectorAll(".effects__radio"),a=r.querySelector(".effect-level__value"),f=document.querySelector(".img-upload__form"),m=f.querySelector(".img-upload__scale"),v=f.querySelector(".img-upload__preview img"),y=f.querySelector(".text__hashtags"),p=f.querySelector(".text__description"),w=f.querySelector(".scale__control--value"),g=document.querySelector("#success").content.querySelector(".success"),h=document.querySelector("#error").content.querySelector(".error");let _=100;const L=function(){let e=(_=a.value,{none:"none",chrome:`grayscale(${_/100})`,sepia:`sepia(${_/100})`,marvin:`invert(${_}%)`,phobos:`blur(${3*_/100}px)`,heat:`brightness(${3*_/100})`});for(let t=0;t<d.length;t++)if(d[t].checked)for(let n in e)d[t].value===n?v.style.filter=e[n]:"none"===d[t].value?i.style.visibility="hidden":i.style.visibility="visible"},S=function(e){e.preventDefault();let t={x:e.clientX};const n=function(e){let n=t.x-e.clientX;t.x=e.clientX;let o=l.offsetLeft-n;o>s.offsetWidth?(o=s.offsetWidth,u.style.width=s.offsetWidth):o<=0?(o=0,u.style.width=0):(u.style.width=o+"px",l.style.left=o+"px"),a.setAttribute("value",Math.round(l.offsetLeft/s.offsetWidth*100)),_=a.value,L()},o=function(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)},q=function(){r.classList.add("hidden"),t.classList.remove("modal-open"),o.value="";for(let e=0;e<d.length;e++)d[e].checked&&(d[e].checked=!1);d[0].checked=!0,l.removeEventListener("mousedown",S),p.value=""},E=function(e){window.util.pressEscKey(e,q)};o.addEventListener("change",(function(){!function(){const t=o.files[0],n=t.name.toLowerCase();if(e.some((function(e){return n.endsWith(e)}))){const e=new FileReader;e.addEventListener("load",(()=>{v.src=e.result;for(let t=0;t<c.length;t++)c[t].style.backgroundImage=`url(${e.result})`})),e.readAsDataURL(t)}}(),r.classList.remove("hidden"),t.classList.add("modal-open"),y.value="",w.value="100%",v.style.transform="scale(1)",L(),m.addEventListener("click",(function(e){!function(e,t){let n=parseInt(t.value,10);e.target.classList.contains("scale__control--smaller")&&(n-=25,t.value=n+"%",n<=25&&(n=25,t.value=n+"%"),v.style.transform=`scale(${n/100})`),e.target.classList.contains("scale__control--bigger")&&(n+=25,t.value=n+"%",n>100&&(n=100,t.value=n+"%"),v.style.transform=`scale(${n/100})`)}(e,w)})),_=a.value,f.addEventListener("change",(function(e){"radio"===e.target.type&&(_=100,a.setAttribute("value",_),l.style.left=s.offsetWidth+"px",u.style.width=s.offsetWidth+"px",L())})),l.addEventListener("mousedown",S),y.addEventListener("focus",(function(){window.removeEventListener("keydown",E)})),y.addEventListener("blur",(function(){window.addEventListener("keydown",E)})),p.addEventListener("focus",(function(){window.removeEventListener("keydown",E)})),p.addEventListener("blur",(function(){window.addEventListener("keydown",E)})),window.addEventListener("keydown",E);const i=function(e){window.util.pressEscKey(e,k)},d=function(){const e=g.cloneNode(!0);q(),n.append(e),e.addEventListener("click",x),window.addEventListener("keydown",i)},b=function(){const e=h.cloneNode(!0);q(),n.append(e),e.addEventListener("click",x),window.addEventListener("keydown",i)},k=function(){let e;const n=document.querySelector(".success"),o=document.querySelector(".error");e=n||o,e.remove(),t.classList.remove("modal-open"),window.removeEventListener("keydown",i),e.removeEventListener("click",x)},x=function(e){const t=e.target;"button"!==t.type&&"section"!==t.tagName.toLowerCase()||k()};f.addEventListener("submit",(function(e){e.preventDefault();const t=new FormData(f);window.server.upload(t,d,b)})),window.form={closePopup:q}}))}(),function(){const e=document.querySelector(".img-upload__form"),t=e.querySelector(".text__hashtags"),n=e.querySelector(".text__description"),o=document.querySelector(".img-upload__overlay").querySelector("#upload-cancel"),r=function(e){return/^#[0-9a-zA-Zа-яА-ЯёЁ]*$/.test(e)};t.addEventListener("input",(function(){!function(){let e=function(e){let t=[],n=e.toLowerCase().split(" ");for(let e of n)""!==e&&t.push(e);return t}(t.value);!function(e){let t=!0;for(let n of e){if(!r(n))return t=!1,t;t=!0}return t}(e)?t.setCustomValidity("Неверный хеш-тег"):e.length>5?t.setCustomValidity("Максимальная количество хеш-тегов не может быть больше 5"):function(e){let t=!1;for(let n of e){if(n.length>20)return t=!0,t;t=!1}return t}(e)?t.setCustomValidity("Максимальная длинна хештега 20 символов"):function(e){let t=!1;for(let n of e){if("#"===n)return t=!0,t;t=!1}return t}(e)?t.setCustomValidity("Хеш-тег не может состоять только из одной решётки"):function(e){let t=[],n=!1;if(e.length>1)for(let o of e){if(-1!==t.indexOf(o))return n=!0,n;t.push(o),n=!1}return n}(e)?t.setCustomValidity("Этот хеш-тег уже используется"):t.setCustomValidity("")}()})),n.addEventListener("input",(function(){!function(){let e=!1;return n.value.length>140&&(e=!0),e}()?n.setCustomValidity(""):n.setCustomValidity("Максимальная длинна сообщения 140 символов")})),o.addEventListener("click",(function(){window.form.closePopup()}))}()})();