(()=>{"use strict";window.util={randomNum:function(e,t){return Math.round(e+Math.random()*(t-e))},randomValue:function(e){return e[Math.floor(Math.random()*e.length)]},pressEscKey:function(e,t){"Escape"===e.key&&t()},debounce:function(e){let t=null;return function(...n){t&&window.clearTimeout(t),t=window.setTimeout((function(){e(...n)}),500)}}},function(){const e="https://21.javascript.pages.academy/kekstagram",t=function(e,t){let n=new XMLHttpRequest;return n.responseType="json",n.addEventListener("load",(function(){let o;switch(n.status){case 200:e(n.response);break;case 400:o="Неверный запрос";break;case 401:o="Пользователь не авторизован";break;case 404:o="Ничего не найдено";break;default:o=`Cтатус ответа: ${n.status} ${n.statusText}`}o&&t(o)})),n.addEventListener("error",(function(){t("Произошла ошибка соединения")})),n.addEventListener("timeout",(function(){t(`Запрос не успел выполниться за ${n.timeout}мс`)})),n.timeout=1e4,n};window.server={load:function(n,o){const i=t(n,o);i.open("GET",e+"/data"),i.send()},upload:function(n,o,i){const r=t(o,i);r.open("POST",e),r.send(n)}}}(),function(){const e=document.querySelector("body");let t=[];window.server.load((function(e){t=e.slice(),function(e){for(let t=0;t<e.length;t++)e[t].id=t}(t),window.gallery(t),window.preview.data(t),window.filter(t)}),(function(t){const n=document.createElement("div");n.textContent=t,n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.padding="50px",n.style.backgroundColor="red",e.append(n)}))}(),function(){const e=document.querySelector(".img-filters"),t=e.querySelectorAll(".img-filters__button"),n=function(){const e=document.querySelectorAll(".picture");for(let t of e)t.remove()};window.filter=function(o){e.classList.remove("img-filters--inactive");let i=o.slice();e.addEventListener("click",window.util.debounce((function(e){!function(e){for(let n=0;n<t.length;n++)t[n].classList.remove("img-filters__button--active"),e.target===t[n]&&t[n].classList.add("img-filters__button--active")}(e);const r=e.target.id;"filter-default"===e.target.id?(n(),window.gallery(o)):"filter-random"===r?(n(),window.gallery(function(e){return e.slice().sort((function(){return window.util.randomNum(-1,1)})).slice(0,10)}(i))):"filter-discussed"===r&&(n(),window.gallery(function(e){return e.sort((function(e,t){return t.comments.length-e.comments.length}))}(i)))})))}}(),function(){const e=document.querySelector(".big-picture"),t=e.querySelector(".social__comments"),n=e.querySelector(".comments-loader"),o=e.querySelector(".big-picture__cancel"),i=document.querySelector(".pictures");let r,c=0,s=5;const l=function(e,t,n){const o=document.createElement("li");o.classList.add("social__comment");const i=document.createElement("img");i.classList.add("social__picture"),i.setAttribute("src",e[t].avatar),i.setAttribute("alt",e[t].name),i.setAttribute("width","35"),i.setAttribute("height","35");const r=document.createElement("p");r.classList.add("social__text"),r.textContent=e[t].message,o.append(i),o.append(r),n.append(o)},u=function(e){const o=e.comments;o.length<s&&(s=o.length,n.classList.add("hidden"));for(let e=c;e<s;e++)l(o,e,t);c+=5,s+=5},d=function(){u(r)},a=function(){c=0,s=5,e.classList.add("hidden"),n.classList.remove("hidden"),n.removeEventListener("click",d)},f=function(e){window.util.pressEscKey(e,a)};o.addEventListener("click",(function(){a(),function(){let e=t.querySelectorAll(".social__comment");for(let t=0;t<e.length;t++)e[t].remove()}(),window.removeEventListener("keydown",f),o.removeEventListener("click",a)})),window.preview={data:function(e){i.addEventListener("click",(function(t){let n=t.target.closest(".picture");if(n)for(let t of e)t.id.toString()===n.dataset.id&&window.preview.show(t)}))},show:function(o){r=o,e.classList.remove("hidden"),document.querySelector("body").classList.add("modal-open"),document.querySelector("body").classList.remove("modal-open"),function(){const e=t.children;for(let t=e.length-1;t>=0;t--)e[t].remove()}(),function(e,t){const n=e.querySelector(".big-picture__img").children,o=e.querySelector(".likes-count"),i=e.querySelector(".comments-count"),c=e.querySelector(".social__caption");n[0].setAttribute("src",t.url),c.textContent=t.description,o.textContent=t.likes,i.textContent=t.comments.length,u(r)}(e,o),n.addEventListener("click",d),window.addEventListener("keydown",f)}}}(),function(){const e=document.querySelector("#picture").content.querySelector(".picture"),t=document.querySelector(".pictures"),n=function(t){const n=e.cloneNode(!0);return n.querySelector(".picture__img").setAttribute("src",t.url),n.querySelector(".picture__img").setAttribute("alt",t.description),n.querySelector(".picture__likes").textContent=t.likes,n.querySelector(".picture__comments").textContent=t.comments.length,n.setAttribute("data-id",t.id),n};window.gallery=function(e){const o=document.createDocumentFragment();for(let t=0;t<e.length;t++)o.appendChild(n(e[t]));t.appendChild(o)}}(),function(){const e=document.querySelector("body"),t=document.querySelector("main"),n=document.querySelector("#upload-file"),o=document.querySelector(".img-upload__overlay"),i=o.querySelector(".effect-level"),r=o.querySelector(".effect-level__line"),c=o.querySelector(".effect-level__pin"),s=o.querySelector(".effect-level__depth"),l=o.querySelectorAll(".effects__radio"),u=o.querySelector(".effect-level__value"),d=document.querySelector(".img-upload__form"),a=d.querySelector(".img-upload__scale"),f=d.querySelector(".img-upload__preview img"),m=d.querySelector(".text__hashtags"),v=d.querySelector(".text__description"),y=d.querySelector(".scale__control--value"),p=document.querySelector("#success").content.querySelector(".success"),w=document.querySelector("#error").content.querySelector(".error");let h=100;const g=function(){let e=(h=u.value,{none:"none",chrome:`grayscale(${h/100})`,sepia:`sepia(${h/100})`,marvin:`invert(${h}%)`,phobos:`blur(${3*h/100}px)`,heat:`brightness(${3*h/100})`});for(let t=0;t<l.length;t++)if(l[t].checked)for(let n in e)l[t].value===n?f.style.filter=e[n]:"none"===l[t].value?i.style.visibility="hidden":i.style.visibility="visible"},_=function(e){e.preventDefault();let t={x:e.clientX};const n=function(e){let n=t.x-e.clientX;t.x=e.clientX;let o=c.offsetLeft-n;o>r.offsetWidth?(o=r.offsetWidth,s.style.width=r.offsetWidth):o<=0?(o=0,s.style.width=0):(s.style.width=o+"px",c.style.left=o+"px"),u.setAttribute("value",Math.round(c.offsetLeft/r.offsetWidth*100)),h=u.value,g()},o=function(){document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",o)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",o)},L=function(){o.classList.add("hidden"),e.classList.remove("modal-open"),n.value="";for(let e=0;e<l.length;e++)l[e].checked&&(l[e].checked=!1);l[0].checked=!0,c.removeEventListener("mousedown",_),v.value=""},S=function(e){window.util.pressEscKey(e,L)};n.addEventListener("change",(function(){o.classList.remove("hidden"),e.classList.add("modal-open"),m.value="",y.value="100%",f.style.transform="scale(1)",g(),a.addEventListener("click",(function(e){!function(e,t){let n=parseInt(t.value,10);e.target.classList.contains("scale__control--smaller")&&(n-=25,t.value=n+"%",n<=25&&(n=25,t.value=n+"%"),f.style.transform=`scale(${n/100})`),e.target.classList.contains("scale__control--bigger")&&(n+=25,t.value=n+"%",n>100&&(n=100,t.value=n+"%"),f.style.transform=`scale(${n/100})`)}(e,y)})),h=u.value,d.addEventListener("change",(function(e){"radio"===e.target.type&&(h=100,u.setAttribute("value",h),c.style.left=r.offsetWidth+"px",s.style.width=r.offsetWidth+"px",g())})),c.addEventListener("mousedown",_),m.addEventListener("focus",(function(){window.removeEventListener("keydown",S)})),m.addEventListener("blur",(function(){window.addEventListener("keydown",S)})),v.addEventListener("focus",(function(){window.removeEventListener("keydown",S)})),v.addEventListener("blur",(function(){window.addEventListener("keydown",S)})),window.addEventListener("keydown",S);const n=function(e){window.util.pressEscKey(e,q)},i=function(){const e=p.cloneNode(!0);L(),t.append(e),e.addEventListener("click",E),window.addEventListener("keydown",n)},l=function(){const e=w.cloneNode(!0);L(),t.append(e),e.addEventListener("click",E),window.addEventListener("keydown",n)},q=function(){let t;const o=document.querySelector(".success"),i=document.querySelector(".error");t=o||i,t.remove(),e.classList.remove("modal-open"),window.removeEventListener("keydown",n),t.removeEventListener("click",E)},E=function(e){const t=e.target;"button"!==t.type&&"section"!==t.tagName.toLowerCase()||q()};d.addEventListener("submit",(function(e){e.preventDefault();const t=new FormData(d);window.server.upload(t,i,l)})),window.form={closePopup:L}}))}(),function(){const e=document.querySelector(".img-upload__form"),t=e.querySelector(".text__hashtags"),n=e.querySelector(".text__description"),o=document.querySelector(".img-upload__overlay").querySelector("#upload-cancel"),i=function(e){return/^#[0-9a-zA-Zа-яА-ЯёЁ]*$/.test(e)};t.addEventListener("input",(function(){!function(){let e=function(e){let t=[],n=e.toLowerCase().split(" ");for(let e of n)""!==e&&t.push(e);return t}(t.value);!function(e){let t=!0;for(let n of e){if(!i(n))return t=!1,t;t=!0}return t}(e)?t.setCustomValidity("Неверный хеш-тег"):e.length>5?t.setCustomValidity("Максимальная количество хеш-тегов не может быть больше 5"):function(e){let t=!1;for(let n of e){if(n.length>20)return t=!0,t;t=!1}return t}(e)?t.setCustomValidity("Максимальная длинна хештега 20 символов"):function(e){let t=!1;for(let n of e){if("#"===n)return t=!0,t;t=!1}return t}(e)?t.setCustomValidity("Хеш-тег не может состоять только из одной решётки"):function(e){let t=[],n=!1;if(e.length>1)for(let o of e){if(-1!==t.indexOf(o))return n=!0,n;t.push(o),n=!1}return n}(e)?t.setCustomValidity("Этот хеш-тег уже используется"):t.setCustomValidity("")}()})),n.addEventListener("input",(function(){!function(){let e=!1;return n.value.length>140&&(e=!0),e}()?n.setCustomValidity(""):n.setCustomValidity("Максимальная длинна сообщения 140 символов")})),o.addEventListener("click",(function(){window.form.closePopup()}))}()})();